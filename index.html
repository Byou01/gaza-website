<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غزة</title>
    <!-- Tailwind CSS Script -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* All CSS is now inside the HTML file */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .main-title {
            font-size: 3rem;
            font-weight: 800;
            color: #292524;
            text-align: center;
            padding: 4rem 1rem 2rem 1rem;
        }
        .section-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #292524;
            margin-bottom: 2rem;
            border-bottom: 2px solid #a8a29e;
            padding-bottom: 0.75rem;
        }
        .content-card {
            background-color: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 2.5rem;
            border: 1px solid #e7e5e4;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .debate-card {
            border-right: 3px solid;
            padding-right: 1.5rem;
        }
        .submit-button {
            background-color: #57534e;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .submit-button:hover {
            background-color: #292524;
        }
    </style>
</head>
<body class="text-stone-700">
    <main class="container max-w-4xl mx-auto p-4 md:p-8">
        <header class="my-8">
            <h1 class="main-title">غزة</h1>
        </header>

        <div class="space-y-16">
            <section id="analysis">
                <div class="content-card">
                    <h2 class="section-title">تحليل استراتيجي للتحديات</h2>
                    <p class="text-stone-600 leading-relaxed text-lg">يتطلب تقييم فعالية المبادرات الشعبية، سواء كانت برية أو بحرية، النظر في عوامل واقعية تتجاوز الهدف المعلن لكسر الحصار. فمن ناحية، تشكل التحركات غير المنسقة لأعداد كبيرة تحدياً سيادياً وأمنياً للدول المجاورة، خاصة في مناطق حدودية حساسة. كما أن إدخال تجمعات مدنية إلى منطقة عمليات عسكرية يرفع من احتمالية التصعيد، حيث يمكن استغلال أي حادث لتوسيع نطاق العمليات. الأهم من ذلك، أن العقبة الحقيقية أمام وصول المساعدات غالباً ما تكون لوجستية وأمنية، وتتعلق بآليات التفتيش والتوزيع المعطلة، وهي تحديات لا تعالجها القوافل البشرية بشكل مباشر.</p>
                </div>
            </section>

             <section id="debate">
                <div class="content-card">
                    <h2 class="section-title">نقاش حول جدوى القوافل البرية</h2>
                    <div class="space-y-8">
                        <div class="debate-card border-stone-400">
                            <h3 class="font-bold text-stone-800">وجهة النظر المتشككة</h3>
                            <p class="mt-1 leading-relaxed">"ما فائدة الذهاب إلى معبر رفح؟ هذه القوافل تأتي بدون مساعدات ملموسة، والهدف هو فقط توريط مصر في مشكلة. إسرائيل لن تسمح لهم بالدخول وستقصفهم، ثم ستُلام مصر."</p>
                        </div>
                        <div class="debate-card border-green-700">
                             <h3 class="font-bold text-green-800">وجهة النظر المتفائلة</h3>
                             <p class="mt-1 leading-relaxed">"الهدف ليس حمل المساعدات، بل كسر الحصار للسماح بمرور المساعدات المتوقفة. الحضور الدولي يجعل أي استهداف إسرائيلي لهم بمثابة هجوم على دول متعددة، مما يغير الحسابات السياسية."</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="positions">
                <div class="content-card">
                    <h2 class="section-title">مواقف الأطراف الرئيسية</h2>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div><h3 class="text-lg font-bold text-stone-800">إسرائيل</h3><p>تعتبر الحصار ضرورياً لأمنها وتصف المبادرات بأنها استفزازية.</p></div>
                        <div><h3 class="text-lg font-bold text-stone-800">حركة حماس</h3><p>تدين الاعتراضات وتعتبرها قرصنة، وتدعو لتوفير الحماية للمبادرات.</p></div>
                        <div><h3 class="text-lg font-bold text-stone-800">الولايات المتحدة</h3><p>تدعو لاستخدام القنوات المعتمدة للمساعدات، وتتجنب انتقاد إسرائيل.</p></div>
                        <div><h3 class="text-lg font-bold text-stone-800">مصر</h3><p>تشدد على ضرورة الحصول على موافقات رسمية لدخول أراضيها.</p></div>
                        <div class="md:col-span-2"><h3 class="text-lg font-bold text-stone-800">الأردن ودول المغرب العربي</h3><p>يوجد دعم شعبي واسع للقوافل، بينما تتخذ الأردن مساراً مؤسسياً.</p></div>
                    </div>
                </div>
            </section>

             <section id="comments">
                <div class="content-card">
                    <h2 class="section-title">شارك برأيك</h2>
                    <form id="comment-form" class="space-y-4">
                        <div>
                            <label for="comment-name" class="block text-sm font-bold text-stone-700 mb-1">الاسم</label>
                            <input type="text" id="comment-name" name="name" class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-stone-500" required>
                        </div>
                        <div>
                            <label for="comment-text" class="block text-sm font-bold text-stone-700 mb-1">التعليق</label>
                            <textarea id="comment-text" name="comment" rows="4" class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-stone-500" required></textarea>
                        </div>
                        <div>
                            <button type="submit" class="submit-button">إضافة تعليق</button>
                        </div>
                    </form>
                    <div id="comments-container" class="mt-8 space-y-6">
                        <!-- Comments will appear here -->
                    </div>
                </div>
            </section>
        </div>
        <footer class="text-center py-10 mt-16">
            <p class="text-stone-500 text-sm">تم تجميع هذا العرض بناءً على مصادر إعلامية وتقارير حقوقية متاحة للعموم.</p>
        </footer>
    </main>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Your JavaScript is now inside the HTML file -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- SUPABASE CLIENT SETUP ---
            const supabaseUrl = 'https://xhvpwcucmrxcxfsmffqs.supabase.co'; 
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhodnB3Y3VjbXJ4Y3hmc21mZnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTgzNDk0MTIsImV4cCI6MjAzMzkyNTQxMn0.JpYJhbgGcI0I3OlU1ZWI5cCI6IkpVCJ9';

            // Check if supabase object exists from CDN
            if (typeof supabase === 'undefined') {
                console.error('Supabase client library not loaded. Check the script tag.');
                return;
            }
            const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

            // --- COMMENTS SECTION FUNCTIONALITY ---
            const commentForm = document.getElementById('comment-form');
            const commentsContainer = document.getElementById('comments-container');
            
            function addCommentToDOM(name, text) {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'p-4 bg-stone-50 rounded-lg border border-stone-200';
                
                const nameElement = document.createElement('h4');
                nameElement.className = 'font-bold text-stone-800';
                nameElement.textContent = name;

                const textElement = document.createElement('p');
                textElement.className = 'text-stone-600 mt-1';
                textElement.textContent = text;
                
                commentDiv.appendChild(nameElement);
                commentDiv.appendChild(textElement);
                commentsContainer.prepend(commentDiv);
            }

            async function loadComments() {
                const { data, error } = await supabaseClient
                    .from('comments')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error fetching comments:', error);
                    alert('حدث خطأ أثناء تحميل التعليقات.');
                    return;
                }

                commentsContainer.innerHTML = ''; 
                data.forEach(comment => {
                    addCommentToDOM(comment.name, comment.text);
                });
            }

            commentForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // This is crucial to prevent page reload

                const nameInput = document.getElementById('comment-name');
                const commentInput = document.getElementById('comment-text');
                const submitButton = commentForm.querySelector('button[type="submit"]');
                
                const name = nameInput.value.trim();
                const text = commentInput.value.trim();

                if (name && text) {
                    submitButton.disabled = true;
                    submitButton.textContent = 'جاري الإضافة...';

                    // We are now submitting to our own serverless function
                    try {
                        const response = await fetch('/api/add-comment', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name, text }),
                        });

                        const result = await response.json();

                        if (!response.ok) {
                            throw new Error(result.message || 'Failed to add comment');
                        }
                        
                        addCommentToDOM(result.comment.name, result.comment.text);
                        nameInput.value = '';
                        commentInput.value = '';

                    } catch (error) {
                        console.error('Error submitting comment:', error);
                        alert('حدث خطأ: ' + error.message);
                    }

                    submitButton.disabled = false;
                    submitButton.textContent = 'إضافة تعليق';
                }
            });
            
            loadComments();
        });
    </script>
</body>
</html>
